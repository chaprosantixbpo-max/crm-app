<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Agent CRM</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        margin: 0;
        padding: 0;
    }
    .container {
        width: 95%;
        max-width: 700px;
        margin: 40px auto;
        background: white;
        padding: 25px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 { text-align: center; }
    input, select, textarea {
        width: 100%; padding: 10px; margin: 8px 0;
        border: 1px solid #ccc; border-radius: 5px;
    }
    button {
        padding: 12px; width: 100%;
        background: #007bff; color: white;
        border: none; border-radius: 5px;
        cursor: pointer; font-size: 16px;
    }
    button:hover { background: #0056b3; }
    .hidden { display: none; }
</style>

</head>
<body>

<div class="container" id="loginBox">
    <h2>Login</h2>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p id="loginError" style="color:red; display:none;">Invalid login</p>
</div>


<div class="container hidden" id="crmBox">
    <h2>Agent CRM</h2>

    <p>Logged in as: <b id="userRole"></b> (<span id="userName"></span>)</p>
    <button onclick="logout()" style="background:#dc3545;">Logout</button>
    <hr>

    <h3>Phone Lookup</h3>
    <input id="phoneSearch" placeholder="Enter phone number">
    <button onclick="lookupPhone()">Search</button>

    <hr>

    <h3>Customer Info</h3>
    <input id="title" placeholder="Title">
    <input id="firstName" placeholder="First Name">
    <input id="lastName" placeholder="Last Name">
    <input id="telephone" placeholder="Telephone">
    <input id="address1" placeholder="Address 1">
    <input id="address2" placeholder="Address 2">
    <input id="address3" placeholder="Address 3">
    <input id="county" placeholder="County">
    <input id="postcode" placeholder="Postcode">
    <input id="age" placeholder="Age">

   <h3>Questions</h3>

<!-- Question 1 -->
<label>Military Opening Question</label>
<select id="militaryOpening">
    <option value="">Select...</option>
    <option>Yes</option>
    <option>No</option>
    <option>Unsure</option>
</select>

<!-- Question 2 -->
<label>Military Q1</label>
<select id="militaryQ1">
    <option value="">Select...</option>
    <option>Yes</option>
    <option>No</option>
</select>

<!-- Question 3 -->
<label>Military Q2</label>
<select id="militaryQ2">
    <option value="">Select...</option>
    <option>Yes</option>
    <option>No</option>
</select>

<!-- Question 4 -->
<label>Military Q3</label>
<select id="militaryQ3">
    <option value="">Select...</option>
    <option>Yes</option>
    <option>No</option>
</select>

<!-- Scotland Questions -->
<label>Scotland Q1</label>
<select id="scotlandQ1">
    <option value="">Select...</option>
    <option>Yes</option>
    <option>No</option>
</select>

<label>Scotland Q2</label>
<select id="scotlandQ2">
    <option value="">Select...</option>
    <option>Yes</option>
    <option>No</option>
</select>

<!-- UK Questions -->
<label>UK Q1</label>
<select id="ukQ1">
    <option value="">Select...</option>
    <option>Yes</option>
    <option>No</option>
</select>

<label>UK Q2</label>
<select id="ukQ2">
    <option value="">Select...</option>
    <option>Yes</option>
    <option>No</option>
</select>


    <textarea id="notes" placeholder="Notes"></textarea>

    <select id="disposition">
        <option value="">Disposition</option>
        <option>Sale</option>
        <option>No Answer</option>
        <option>Callback</option>
        <option>Not Interested</option>
    </select>

    <button onclick="saveCall()" style="background:green;">Save Call</button>

    <p id="saveMsg" style="color:green; display:none;">Saved!</p>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbx2xtqNr70wqg4w6ChxSkkdhapgpJ2Vun2DuxkUhsgqWplT183j2phyfiOoTQv0BTNV/exec"; // <<<< REPLACE THIS ONLY

// LOGIN
async function login() {
    let u = document.getElementById("username").value.trim();
    let p = document.getElementById("password").value.trim();

    let res = await fetch("users.json"); // This file MUST exist later
    let users = await res.json();

    if (!users[u] || users[u].password != p) {
        document.getElementById("loginError").style.display = "block";
        return;
    }

    localStorage.setItem("user", JSON.stringify(users[u]));
    showCRM();
}

function showCRM() {
    let user = JSON.parse(localStorage.getItem("user") || "{}");
    if (!user.username) return;

    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("crmBox").classList.remove("hidden");

    document.getElementById("userRole").innerText = user.role;
    document.getElementById("userName").innerText = user.username;
}

function logout() {
    localStorage.removeItem("user");
    location.reload();
}

// PHONE LOOKUP
async function lookupPhone() {
    let phone = document.getElementById("phoneSearch").value;
    let res = await fetch(API_URL + "?phone=" + phone);
    let data = await res.json();

    if (data.error) { alert("Not found"); return; }

    for (let k in data) { 
        if (document.getElementById(k)) {
            document.getElementById(k).value = data[k];
        }
    }
}

// SAVE CALL
async function saveCall() {
    const payload = {
        phone: document.getElementById('telephone').value,
        title: document.getElementById('title').value,
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        telephone: document.getElementById('telephone').value,
        address1: document.getElementById('address1').value,
        address2: document.getElementById('address2').value,
        address3: document.getElementById('address3').value,
        county: document.getElementById('county').value,
        postcode: document.getElementById('postcode').value,
        age: document.getElementById('age').value,

        // âœ… NEW DROPDOWNS (Non-editable questions + fixed answers)
        militaryOpening: document.getElementById('militaryOpening').value,
        militaryQ1: document.getElementById('militaryQ1').value,
        militaryQ2: document.getElementById('militaryQ2').value,
        militaryQ3: document.getElementById('militaryQ3').value,

        scotlandQ1: document.getElementById('scotlandQ1').value,
        scotlandQ2: document.getElementById('scotlandQ2').value,

        ukQ1: document.getElementById('ukQ1').value,
        ukQ2: document.getElementById('ukQ2').value,

        notes: document.getElementById('notes').value,
        disposition: document.getElementById('disposition').value,
        agent: localStorage.getItem("loggedUser") || ""
    };

    try {
        const response = await fetch(API_URL, {
            method: "POST",
            contentType: "application/json",
            body: JSON.stringify(payload)
        });

        if (response.ok) {
            alert("Call saved successfully!");
        } else {
            alert("Failed to save call.");
        }
    } catch (err) {
        console.error(err);
        alert("Error saving call.");
    }
}
;

    await fetch(API_URL, {
        method: "POST",
        contentType: "application/json",
        body: JSON.stringify(body)
    });

    document.getElementById("saveMsg").style.display = "block";
    setTimeout(() => document.getElementById("saveMsg").style.display = "none", 2000);
}

// AUTO LOGIN IF SESSION EXISTS
showCRM();
</script>

</body>
</html>


